<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRコード生成＆PDF出力ツール</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">QRコード生成 & PDF出力</h1>

        <div class="mb-6">
            <label class="block text-gray-700 text-sm font-bold mb-2" for="urlInput">
                変換したいURL (アドレス)
            </label>
            <input type="text" id="urlInput" placeholder="https://example.com" 
                class="shadow appearance-none border rounded w-full py-3 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                value="https://www.google.com">
        </div>

        <div class="flex gap-2 mb-6">
            <button onclick="generateQR()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-200">
                QR作成
            </button>
            <button onclick="clearInput()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded transition duration-200">
                クリア
            </button>
        </div>

        <div id="qr-container" class="flex justify-center items-center mb-6 p-4 border-2 border-dashed border-gray-300 rounded min-h-[200px]">
            <div id="qrcode"></div>
            <p id="placeholder-text" class="text-gray-400 text-sm">ここにQRコードが表示されます</p>
        </div>

        <button id="pdf-btn" onclick="downloadPDF()" disabled 
            class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            PDFとして保存
        </button>

        <p class="mt-4 text-xs text-center text-gray-500">
            スマホの標準カメラアプリで読み取るとWebページが開きます。
        </p>
    </div>

    <script>
        const qrContainer = document.getElementById("qrcode");
        const placeholderText = document.getElementById("placeholder-text");
        const pdfBtn = document.getElementById("pdf-btn");
        let qrCodeObj = null;

        // 初期状態でQRを生成しておく
        window.onload = function() {
            generateQR();
        };

        function generateQR() {
            const url = document.getElementById("urlInput").value;

            if (!url) {
                alert("URLを入力してください");
                return;
            }

            // 表示のリセット
            qrContainer.innerHTML = "";
            placeholderText.style.display = "none";
            pdfBtn.disabled = false;

            // QRコード生成
            qrCodeObj = new QRCode(qrContainer, {
                text: url,
                width: 200,
                height: 200,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
        }

        function clearInput() {
            document.getElementById("urlInput").value = "";
            qrContainer.innerHTML = "";
            placeholderText.style.display = "block";
            pdfBtn.disabled = true;
        }

        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const url = document.getElementById("urlInput").value;
            
            // QRコードの画像データを取得 (Base64)
            const qrImage = qrContainer.querySelector("img");
            
            if (!qrImage) {
                alert("QRコードが生成されていません。");
                return;
            }

            // 画像のロード待ちが必要な場合があるため確認
            if (!qrImage.src) {
                // canvas要素から取得を試みる（ライブラリの挙動による）
                const canvas = qrContainer.querySelector("canvas");
                if(canvas) {
                    qrImage.src = canvas.toDataURL("image/png");
                } else {
                    alert("画像生成エラー。もう一度「QR作成」を押してください。");
                    return;
                }
            }

            // PDF生成設定 (A4サイズ)
            const doc = new jsPDF({
                orientation: "portrait",
                unit: "mm",
                format: "a4"
            });

            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();

            // タイトル
            doc.setFontSize(24);
            doc.text("QR Access Code", pageWidth / 2, 40, { align: "center" });

            // QRコード画像配置
            const imgSize = 80; // 80mm
            const x = (pageWidth - imgSize) / 2;
            const y = 60;
            doc.addImage(qrImage.src, 'PNG', x, y, imgSize, imgSize);

            // URLテキスト表示
            doc.setFontSize(12);
            doc.setTextColor(100);
            
            // 長いURLを折り返す処理
            const splitUrl = doc.splitTextToSize(url, pageWidth - 40);
            doc.text(splitUrl, pageWidth / 2, y + imgSize + 20, { align: "center" });

            // 案内文
            doc.setFontSize(10);
            doc.setTextColor(150);
            doc.text("Scan this QR code with your smartphone camera.", pageWidth / 2, pageHeight - 30, { align: "center" });

            // 保存
            doc.save("qrcode.pdf");
        }
    </script>

<script id="lfs-meta" type="application/json">
{
  "appId": "1e632c0d2dc9e8cf9b72e8d0a7b59198",
  "createdAt": "2026-01-13T15:47:56.638Z",
  "schema": 2,
  "title": "QRコード生成＆PDF出力ツール",
  "savedAt": "2026-01-13T15:47:56.638Z",
  "aiInstruction": "",
  "comment": "",
  "sourceMode": "single",
  "runId": "d2a73e861c82f9118e2990a130fb90ee"
}
</script>
</body>
</html>